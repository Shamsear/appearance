<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Edit Match Results</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
        :root {
            --primary-color: #0d6efd;
            --secondary-color: #6c757d;
            --success-color: #198754;
            --danger-color: #dc3545;
            --light-bg: #f8f9fa;
        }
        
        body {
            padding-top: 2rem;
            background-color: var(--light-bg);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .admin-container {
            max-width: 1000px;
            margin: 0 auto 2rem auto;
        }
        
        .card {
            border: none;
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 2rem;
            overflow: hidden;
        }
        
        .card-header {
            background-color: var(--primary-color);
            color: white;
            padding: 1.5rem;
            border-bottom: none;
        }
        
        .card-body {
            padding: 2rem;
        }
        
        .team-section {
            margin-bottom: 1.5rem;
            padding: 1.5rem;
            border-radius: 8px;
            background-color: white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        .team-header {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .team-icon {
            font-size: 1.5rem;
            margin-right: 0.75rem;
        }
        
        .home-team .team-icon {
            color: var(--primary-color);
        }
        
        .away-team .team-icon {
            color: var(--danger-color);
        }
        
        .player-row {
            transition: background-color 0.2s;
        }
        
        .player-row:hover {
            background-color: rgba(0, 0, 0, 0.02);
        }
        
        .player-toggle {
            cursor: pointer;
        }
        
        .player-toggle.active {
            color: var(--success-color);
            font-weight: bold;
        }
        
        .player-toggle.inactive {
            color: var(--danger-color);
        }
        
        .add-player-section {
            margin-top: 1.5rem;
            padding: 1.5rem;
            border: 1px dashed #dee2e6;
            border-radius: 8px;
        }
        
        .match-info {
            background-color: white;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        .btn-admin {
            background-color: var(--primary-color);
            color: white;
            padding: 0.6rem 1.5rem;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="container admin-container">
        <div class="card">
            <div class="card-header">
                <div class="d-flex justify-content-between align-items-center">
                    <h1 class="mb-0">Admin - Edit Match Results</h1>
                    <a href="{{ url_for('teams') }}" class="btn btn-outline-light">
                        <i class="bi bi-arrow-left me-2"></i>Back to Teams
                    </a>
                </div>
            </div>
            
            <div class="card-body">
                <!-- Flash Messages -->
                {% with messages = get_flashed_messages() %}
                    {% if messages %}
                        <div class="mb-4">
                            {% for message in messages %}
                                <div class="alert alert-info alert-dismissible fade show" role="alert">
                                    {{ message }}
                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}
                {% endwith %}
                
                <!-- Match Info -->
                <div class="match-info">
                    <div class="row align-items-center">
                        <div class="col-md-6">
                            <h3>{{ match.match_day }}</h3>
                            <h4>{{ home_team.name }} vs {{ away_team.name }}</h4>
                            <p class="text-muted mb-0">Date: {{ match.date or 'Not specified' }}</p>
                        </div>
                        <div class="col-md-6 text-md-end">
                            <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#editMatchModal">
                                <i class="bi bi-pencil me-2"></i>Edit Match Details
                            </button>
                        </div>
                    </div>
                </div>
                
                <form action="{{ url_for('admin_update_results', match_id=match.id) }}" method="post" id="editResultsForm">
                    <div class="row">
                        <!-- Home Team -->
                        <div class="col-md-6">
                            <div class="team-section home-team">
                                <div class="team-header">
                                    <i class="bi bi-house-door team-icon"></i>
                                    <h4 class="mb-0">{{ home_team.name }} (Home)</h4>
                                </div>
                                
                                <!-- Search bar for home team -->
                                <div class="mb-3">
                                    <input type="text" class="form-control" id="homeTeamSearch" placeholder="Search players..." onkeyup="filterPlayers('homeTeamSearch', 'homeTeamTable')">
                                </div>
                                
                                <div class="table-responsive">
                                    <table class="table" id="homeTeamTable">
                                        <thead>
                                            <tr>
                                                <th>Player</th>
                                                <th>Salary</th>
                                                <th class="text-center">Appeared</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for player in all_home_players|sort(attribute='name') %}
                                                <tr class="player-row">
                                                    <td>{{ player.name }}</td>
                                                    <td>{{ player.salary or 'Unknown' }}</td>
                                                    <td class="text-center">
                                                        <div class="form-check form-switch d-flex justify-content-center">
                                                            <input class="form-check-input" type="checkbox" 
                                                                   name="home_player_{{ player.id }}" 
                                                                   id="home_player_{{ player.id }}"
                                                                   {% if player.id in home_appeared_ids %}checked{% endif %}>
                                                        </div>
                                                    </td>
                                                </tr>
                                            {% else %}
                                                <tr>
                                                    <td colspan="3" class="text-center">No players found for this team.</td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                                
                                <div class="add-player-section">
                                    <h5><i class="bi bi-plus-circle me-2"></i>Add New Player</h5>
                                    <div class="row g-2 align-items-center">
                                        <div class="col-md-5">
                                            <input type="text" class="form-control" name="new_home_player_name" placeholder="Player Name">
                                        </div>
                                        <div class="col-md-4">
                                            <select class="form-select" name="new_home_player_position">
                                                <option value="FWD">Forward</option>
                                                <option value="MID" selected>Midfielder</option>
                                                <option value="DEF">Defender</option>
                                                <option value="GK">Goalkeeper</option>
                                            </select>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" name="new_home_player_appeared" id="new_home_player_appeared" checked>
                                                <label class="form-check-label" for="new_home_player_appeared">
                                                    Appeared
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Away Team -->
                        <div class="col-md-6">
                            <div class="team-section away-team">
                                <div class="team-header">
                                    <i class="bi bi-airplane team-icon"></i>
                                    <h4 class="mb-0">{{ away_team.name }} (Away)</h4>
                                </div>
                                
                                <!-- Search bar for away team -->
                                <div class="mb-3">
                                    <input type="text" class="form-control" id="awayTeamSearch" placeholder="Search players..." onkeyup="filterPlayers('awayTeamSearch', 'awayTeamTable')">
                                </div>
                                
                                <div class="table-responsive">
                                    <table class="table" id="awayTeamTable">
                                        <thead>
                                            <tr>
                                                <th>Player</th>
                                                <th>Salary</th>
                                                <th class="text-center">Appeared</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for player in all_away_players|sort(attribute='name') %}
                                                <tr class="player-row">
                                                    <td>{{ player.name }}</td>
                                                    <td>{{ player.salary or 'Unknown' }}</td>
                                                    <td class="text-center">
                                                        <div class="form-check form-switch d-flex justify-content-center">
                                                            <input class="form-check-input" type="checkbox" 
                                                                   name="away_player_{{ player.id }}" 
                                                                   id="away_player_{{ player.id }}"
                                                                   {% if player.id in away_appeared_ids %}checked{% endif %}>
                                                        </div>
                                                    </td>
                                                </tr>
                                            {% else %}
                                                <tr>
                                                    <td colspan="3" class="text-center">No players found for this team.</td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                                
                                <div class="add-player-section">
                                    <h5><i class="bi bi-plus-circle me-2"></i>Add New Player</h5>
                                    <div class="row g-2 align-items-center">
                                        <div class="col-md-5">
                                            <input type="text" class="form-control" name="new_away_player_name" placeholder="Player Name">
                                        </div>
                                        <div class="col-md-4">
                                            <select class="form-select" name="new_away_player_position">
                                                <option value="FWD">Forward</option>
                                                <option value="MID" selected>Midfielder</option>
                                                <option value="DEF">Defender</option>
                                                <option value="GK">Goalkeeper</option>
                                            </select>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" name="new_away_player_appeared" id="new_away_player_appeared" checked>
                                                <label class="form-check-label" for="new_away_player_appeared">
                                                    Appeared
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-flex justify-content-between mt-4">
                        <a href="{{ url_for('match_stats', match_id=match.id) }}" class="btn btn-outline-secondary">
                            <i class="bi bi-x-circle me-2"></i>Cancel
                        </a>
                        <button type="submit" class="btn btn-admin">
                            <i class="bi bi-save me-2"></i>Save Changes
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Edit Match Modal -->
    <div class="modal fade" id="editMatchModal" tabindex="-1" aria-labelledby="editMatchModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form action="{{ url_for('admin_update_match', match_id=match.id) }}" method="post">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editMatchModalLabel">Edit Match Details</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="match_day" class="form-label">Match Day</label>
                            <input type="text" class="form-control" id="match_day" name="match_day" value="{{ match.match_day }}">
                        </div>
                        <div class="mb-3">
                            <label for="match_date" class="form-label">Match Date</label>
                            <input type="date" class="form-control" id="match_date" name="match_date" value="{{ match.date }}">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary">Save changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        function filterPlayers(inputId, tableId) {
            // Get input value and convert to uppercase for case-insensitive search
            const input = document.getElementById(inputId);
            const filter = input.value.toUpperCase();
            
            // Get table and rows
            const table = document.getElementById(tableId);
            const rows = table.getElementsByTagName("tr");
            
            // Loop through rows and hide those that don't match the search query
            for (let i = 1; i < rows.length; i++) { // Start from 1 to skip header row
                const nameCell = rows[i].getElementsByTagName("td")[0]; // First column contains player name
                if (nameCell) {
                    const nameText = nameCell.textContent || nameCell.innerText;
                    if (nameText.toUpperCase().indexOf(filter) > -1) {
                        rows[i].style.display = "";
                    } else {
                        rows[i].style.display = "none";
                    }
                }
            }
        }
    </script>
</body>
</html> 